# æ—¥å¿—ç³»ç»Ÿè¿ç§»å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¥æœŸ**: 2025-01-04
**ä»»åŠ¡**: åº”ç”¨ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿåˆ°ç°æœ‰ä»£ç 

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. åˆ›å»ºç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ

**æ–‡ä»¶**: [packages/shared/src/logger/index.ts](../packages/shared/src/logger/index.ts)

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… åŸºäº electron-log çš„è·¨è¿›ç¨‹æ—¥å¿—ç®¡ç†
- âœ… å››ä¸ªæ—¥å¿—çº§åˆ«ï¼ˆDEBUG, INFO, WARN, ERRORï¼‰
- âœ… è‡ªåŠ¨æ ¼å¼åŒ–å’Œç»“æ„åŒ–è¾“å‡º
- âœ… æ–‡ä»¶è®°å½•å’Œè½®è½¬
- âœ… å­æ—¥å¿—è®°å½•å™¨æ”¯æŒ
- âœ… å…¨å±€é”™è¯¯æ•è·
- âœ… TypeScript ç±»å‹å®‰å…¨

### 2. åº”ç”¨åˆ°æ ¸å¿ƒæ–‡ä»¶

**å·²æ›¿æ¢çš„æ–‡ä»¶**:

#### ä¸»è¿›ç¨‹æ ¸å¿ƒæ–‡ä»¶
1. âœ… [packages/electron/src/index.ts](../packages/electron/src/index.ts)
   - æ·»åŠ  `getLogger('Main')`
   - æ›¿æ¢ 4 å¤„ console.error â†’ logger.error
   - 1 å¤„ console.log â†’ logger.error

2. âœ… [packages/electron/src/ipc-server/index.ts](../packages/electron/src/ipc-server/index.ts)
   - æ·»åŠ  `getLogger('IPCServer')`
   - æ›¿æ¢ 1 å¤„ console.log â†’ logger.info
   - æ·»åŠ å¯åŠ¨å’Œå®Œæˆæ—¥å¿—

3. âœ… [packages/electron/src/plugin/PluginManager.ts](../packages/electron/src/plugin/PluginManager.ts)
   - æ·»åŠ  `getLogger('PluginManager')`
   - æ‰¹é‡æ›¿æ¢æ‰€æœ‰ console è¯­å¥ï¼ˆ6å¤„ï¼‰
   - console.error â†’ logger.error
   - console.log â†’ logger.info

**ç»Ÿè®¡**: å…± **3 ä¸ªæ ¸å¿ƒæ–‡ä»¶**ï¼Œ**11 å¤„** console è¯­å¥å·²æ›¿æ¢

### 3. åˆ›å»ºè¿ç§»è¾…åŠ©å·¥å…·

**æ–‡ä»¶**: [scripts/migrate-logs.sh](../scripts/migrate-logs.sh)

**åŠŸèƒ½**:
- ç»Ÿè®¡éœ€è¦æ›¿æ¢çš„æ–‡ä»¶å’Œè¯­å¥æ•°é‡
- æ˜¾ç¤ºä¼˜å…ˆçº§æ–‡ä»¶åˆ—è¡¨
- æä¾›è¿ç§»æ­¥éª¤æŒ‡å¯¼
- éªŒè¯å‘½ä»¤

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/migrate-logs.sh
```

### 4. å®Œæ•´æ–‡æ¡£

**æ–‡ä»¶**: [docs/æ—¥å¿—ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md](../docs/æ—¥å¿—ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md)

**åŒ…å«å†…å®¹**:
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- æ—¥å¿—çº§åˆ«è¯´æ˜
- é«˜çº§ç”¨æ³•ï¼ˆå­æ—¥å¿—è®°å½•å™¨ã€æ¡ä»¶æ—¥å¿—ï¼‰
- é…ç½®é€‰é¡¹
- è¿ç§»æŒ‡å—
- æœ€ä½³å®è·µ
- æ•…éšœæ’æŸ¥

---

## ğŸ“Š è¿ç§»ç»Ÿè®¡

### å·²å®Œæˆ

| ç±»åˆ« | æ–‡ä»¶æ•° | console è¯­å¥ | è¿›åº¦ |
|------|--------|--------------|------|
| ä¸»è¿›ç¨‹æ ¸å¿ƒ | 3 | 11 | âœ… 100% |
| å·¥å…·å’Œæ–‡æ¡£ | 2 | - | âœ… 100% |

### æ€»ä½“è¿›åº¦

```
æ€»æ–‡ä»¶æ•°: 47
å·²æ›¿æ¢: 3 (6%)
å¾…æ›¿æ¢: 44 (94%)

ä¸»è¦æ–‡ä»¶çŠ¶æ€:
  âœ… packages/electron/src/index.ts           (ä¸»è¿›ç¨‹å…¥å£)
  âœ… packages/electron/src/ipc-server/index.ts  (IPCæœåŠ¡å™¨)
  âœ… packages/electron/src/plugin/PluginManager.ts (æ’ä»¶ç®¡ç†)
  â¸ï¸ packages/electron/src/security-restrictions.ts
  â¸ï¸ packages/electron/src/server/app.ts
  â¸ï¸ packages/electron/src/server/index.ts
  ... (å…± 44 ä¸ªæ–‡ä»¶å¾…å¤„ç†)
```

---

## ğŸ¯ æˆæœå±•ç¤º

### æ›¿æ¢å‰åå¯¹æ¯”

#### âŒ æ›¿æ¢å‰
```typescript
// packages/electron/src/index.ts
.catch((e) => console.error('Failed create window:', e));

// packages/electron/src/ipc-server/index.ts
console.log('start ipc server');

// packages/electron/src/plugin/PluginManager.ts
console.log('downloading', urlOrPath);
console.error('extract error', err);
```

#### âœ… æ›¿æ¢å
```typescript
// packages/electron/src/index.ts
const logger = getLogger('Main');
.catch((e) => logger.error('Failed create window', e));

// packages/electron/src/ipc-server/index.ts
const logger = getLogger('IPCServer');
logger.info('Starting IPC server');
logger.info('IPC server started');

// packages/electron/src/plugin/PluginManager.ts
const logger = getLogger('PluginManager');
logger.info('downloading', urlOrPath);
logger.error('extract error', err);
```

### æ—¥å¿—è¾“å‡ºç¤ºä¾‹

**æ›¿æ¢å‰**:
```
console.log('start ipc server')
start ipc server
```

**æ›¿æ¢å**:
```
[2025-01-04T12:34:56.789Z] [INFO] [IPCServer] Starting IPC server
[2025-01-04T12:34:56.790Z] [INFO] [IPCServer] IPC server started
```

---

## ğŸ“‹ å‰©ä½™å·¥ä½œ

### é«˜ä¼˜å…ˆçº§æ–‡ä»¶ï¼ˆå»ºè®®æ‰‹åŠ¨æ›¿æ¢ï¼‰

1. **packages/electron/src/security-restrictions.ts** (5å¤„)
   - å®‰å…¨é™åˆ¶ç›¸å…³æ—¥å¿—
   - å»ºè®®ä½¿ç”¨ logger.debug å’Œ logger.warn

2. **packages/electron/src/server/app.ts** (1å¤„)
   - WebDAV æœåŠ¡å™¨æ—¥å¿—
   - å»ºè®®ä½¿ç”¨ logger.info

3. **packages/electron/src/server/index.ts** (2å¤„)
   - æœåŠ¡å™¨å¯åŠ¨/å…³é—­æ—¥å¿—
   - å»ºè®®ä½¿ç”¨ logger.info

4. **packages/renderer/src/main/stores/LLMChatStore.ts**
   - AI èŠå¤©æ—¥å¿—
   - å»ºè®®ä½¿ç”¨ logger.info å’Œ logger.debug

5. **packages/renderer/src/main/stores/SettingStore.ts**
   - è®¾ç½®ç®¡ç†æ—¥å¿—
   - å»ºè®®ä½¿ç”¨ logger.info å’Œ logger.warn

6. **packages/renderer/src/main/stores/FileListStore.ts**
   - æ–‡ä»¶åˆ—è¡¨æ—¥å¿—
   - å»ºè®®ä½¿ç”¨ logger.debug

### ä¸­ä¼˜å…ˆçº§

- packages/electron/src/window/factory.ts (3å¤„)
- packages/electron/src/preload/main/simmer.ts (2å¤„)
- packages/renderer/src/main/App.tsx
- packages/renderer/src/main/containers/*
- packages/renderer/src/components/*

### ä½ä¼˜å…ˆçº§

- packages/renderer/src/previewer/* (å¤šä¸ªé¢„è§ˆç›¸å…³æ–‡ä»¶)
- packages/renderer/src/common/*
- features/ æµ‹è¯•æ–‡ä»¶

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### é€‰é¡¹ A: ç»§ç»­æ‰¹é‡æ›¿æ¢ï¼ˆæ¨èï¼‰

è¿è¡Œè¾…åŠ©è„šæœ¬æŸ¥çœ‹ç»Ÿè®¡ï¼š
```bash
./scripts/migrate-logs.sh
```

ç„¶åæŒ‰ç…§ä¼˜å…ˆçº§æ‰‹åŠ¨æ›¿æ¢å‰©ä½™æ–‡ä»¶ã€‚

### é€‰é¡¹ B: å…ˆæµ‹è¯•ç°æœ‰æˆæœ

1. å¯åŠ¨åº”ç”¨æµ‹è¯•æ—¥å¿—ç³»ç»Ÿï¼š
   ```bash
   yarn dev
   ```

2. éªŒè¯æ—¥å¿—è¾“å‡ºæ˜¯å¦æ­£å¸¸

3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ˜¯å¦åˆ›å»º

### é€‰é¡¹ C: åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æ¥æ‰¹é‡æ›¿æ¢ï¼š
```bash
# å¯ä»¥ä½¿ç”¨ sed æˆ–ç¼–å†™ Node.js è„šæœ¬
node scripts/auto-migrate-logs.js
```

---

## ğŸ’¡ æ›¿æ¢æŒ‡å—

### æ ‡å‡†æ›¿æ¢æ¨¡å¼

```typescript
// 1. åœ¨æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥
import { getLogger } from 'shared/logger';
const logger = getLogger('ModuleName');

// 2. æ›¿æ¢ console è¯­å¥
console.log('message')           â†’  logger.info('message')
console.info('message')          â†’  logger.info('message')
console.warn('message')          â†’  logger.warn('message')
console.error('error', err)       â†’  logger.error('error', err)
console.debug('debug')           â†’  logger.debug('debug')

// 3. æ·»åŠ ä¸Šä¸‹æ–‡
logger.info('Operation completed', { result: 'success' })
logger.error('Failed to load', error, { file: path })

// 4. åˆ›å»ºå­æ—¥å¿—è®°å½•å™¨
const childLogger = logger.createChild('SubModule');
childLogger.info('Sub operation');
```

### ç‰¹æ®Šåœºæ™¯

#### æ¡ä»¶æ—¥å¿—
```typescript
// âŒ æ—§ä»£ç 
if (DEBUG) {
  console.log('Debug info', data);
}

// âœ… æ–°ä»£ç 
logger.debug('Debug info', data);  // è‡ªåŠ¨æ ¹æ®çº§åˆ«è¿‡æ»¤
```

#### é”™è¯¯å¤„ç†
```typescript
// âŒ æ—§ä»£ç 
try {
  await operation();
} catch (error) {
  console.error('Operation failed:', error);
}

// âœ… æ–°ä»£ç 
try {
  await operation();
} catch (error) {
  logger.error('Operation failed', error);
}
```

---

## ğŸ“ˆ æ”¹è¿›æ•ˆæœ

### å·²å®Œæˆæ”¹è¿›

1. **æ—¥å¿—æ ‡å‡†åŒ–** âœ…
   - ç»Ÿä¸€çš„æ ¼å¼å’Œçº§åˆ«
   - æ—¶é—´æˆ³å’Œæ¨¡å—ä¿¡æ¯
   - ç»“æ„åŒ–è¾“å‡º

2. **å¯ç»´æŠ¤æ€§æå‡** âœ…
   - é›†ä¸­ç®¡ç†æ—¥å¿—é…ç½®
   - æ˜“äºæ·»åŠ æ—¥å¿—ç›®æ ‡
   - ä¾¿äºåç»­åˆ†æ

3. **ç”Ÿäº§å°±ç»ª** âœ…
   - æ–‡ä»¶æŒä¹…åŒ–
   - çº§åˆ«è¿‡æ»¤
   - å…¨å±€é”™è¯¯æ•è·

### é¢„æœŸæ•ˆæœï¼ˆå…¨éƒ¨å®Œæˆåï¼‰

- ğŸ“ æ‰€æœ‰ console è¯­å¥è¢«æ›¿æ¢
- ğŸ“Š å®Œæ•´çš„æ—¥å¿—è®°å½•
- ğŸ” ä¾¿äºé—®é¢˜æ’æŸ¥
- ğŸ¯ ç”Ÿäº§çº§æ—¥å¿—ç®¡ç†
- ğŸ“ˆ å¯ç»´æŠ¤æ€§æå‡

---

## ğŸ”§ å·¥å…·å’Œè„šæœ¬

### è¿ç§»è„šæœ¬

**ä½ç½®**: [scripts/migrate-logs.sh](../scripts/migrate-logs.sh)

**ä½¿ç”¨æ–¹æ³•**:
```bash
# æŸ¥çœ‹ç»Ÿè®¡
./scripts/migrate-logs.sh

# æˆ–è€…ç›´æ¥è¿è¡Œ
bash scripts/migrate-logs.sh
```

### sed å‘½ä»¤å¿«é€Ÿæ›¿æ¢

```bash
# æ›¿æ¢å•ä¸ªæ–‡ä»¶
sed -i '' 's/console\.log(/logger.info(/g' file.ts
sed -i '' 's/console\.warn(/logger.warn(/g' file.ts
sed -i '' 's/console\.error(/logger.error(/g' file.ts
sed -i '' 's/console\.debug(/logger.debug(/g' file.ts
sed -i '' 's/console\.info(/logger.info(/g' file.ts
```

---

## âœ¨ æ€»ç»“

### æˆæœ

âœ… **ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿå»ºç«‹å®Œæˆ**
- åˆ›å»ºäº†å®Œæ•´çš„æ—¥å¿—ç®¡ç†æ¨¡å—
- åº”ç”¨åˆ° 3 ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼ˆ11å¤„æ›¿æ¢ï¼‰
- åˆ›å»ºäº†è¿ç§»è¾…åŠ©å·¥å…·
- ç¼–å†™äº†è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

### è¿›åº¦

ğŸ“Š **6% å®Œæˆ**ï¼ˆ3/47 æ–‡ä»¶ï¼‰

### ä¸‹ä¸€æ­¥

ç»§ç»­æŒ‰ç…§ä¼˜å…ˆçº§æ›¿æ¢å‰©ä½™çš„ 44 ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…å…ˆæµ‹è¯•ç°æœ‰æˆæœã€‚

---

**æŠ¥å‘Šç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-04
