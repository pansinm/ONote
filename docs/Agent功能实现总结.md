# Agent åŠŸèƒ½å®žçŽ°æ€»ç»“

## å·²å®Œæˆçš„å·¥ä½œ

### Phase 1: åŸºç¡€è®¾æ–½ âœ…

1. **ç±»åž‹å®šä¹‰** (`packages/renderer/src/llmbox/agent/types.ts`)
   - âœ… å®šä¹‰äº† Toolã€ToolParameterã€ToolCall ç­‰æ ¸å¿ƒç±»åž‹
   - âœ… å®šä¹‰äº† ExecutionStep ç”¨äºŽ UI æ˜¾ç¤º
   - âœ… å®šä¹‰äº† AgentConfig é…ç½®æŽ¥å£

2. **å·¥å…·æ³¨å†Œè¡¨** (`packages/renderer/src/llmbox/agent/ToolRegistry.ts`)
   - âœ… å®žçŽ°äº† ToolRegistry ç±»
   - âœ… æ³¨å†Œäº† 7 ä¸ªå†…ç½®å·¥å…·ï¼š
     - readFile - è¯»å–æ–‡ä»¶
     - writeFile - å†™å…¥æ–‡ä»¶
     - createFile - åˆ›å»ºæ–‡ä»¶
     - deleteFile - åˆ é™¤æ–‡ä»¶
     - listFiles - åˆ—å‡ºç›®å½•
     - searchFiles - æœç´¢æ–‡ä»¶
     - searchInFile - æ–‡ä»¶å†…æœç´¢
   - âœ… å®žçŽ°äº†é€šè¿‡ bidc ä¸Žä¸»çª—å£é€šä¿¡çš„å·¥å…·æ‰§è¡Œå™¨

3. **æ¶ˆæ¯ç±»åž‹æ‰©å±•** (`packages/renderer/src/main/containers/LLMBox/constants.ts`)
   - âœ… æ·»åŠ äº† Agent æ–‡ä»¶æ“ä½œæ¶ˆæ¯ç±»åž‹
   - âœ… æ·»åŠ äº† Agent çŠ¶æ€æŸ¥è¯¢æ¶ˆæ¯ç±»åž‹

4. **LLMBoxFrame æ‰©å±•** (`packages/renderer/src/main/containers/LLMBox/LLMBoxFrame.tsx`)
   - âœ… å®žçŽ°äº†æ‰€æœ‰ Agent æ–‡ä»¶æ“ä½œçš„æ¶ˆæ¯å¤„ç†
   - âœ… é€šè¿‡ onote.dataSource è°ƒç”¨æ–‡ä»¶æ“ä½œ

### Phase 2: Agent æ ¸å¿ƒé€»è¾‘ âœ…

1. **Agent ç¼–æŽ’å™¨** (`packages/renderer/src/llmbox/agent/AgentOrchestrator.ts`)
   - âœ… å®žçŽ°äº† AgentOrchestrator ç±»
   - âœ… å®žçŽ°äº† LLM è°ƒç”¨
   - âœ… å®žçŽ°äº†å¤šè½®è¿­ä»£å¾ªçŽ¯
   - âœ… å®žçŽ°äº†å·¥å…·è°ƒç”¨å’Œç»“æžœå¤„ç†
   - âœ… å®žçŽ°äº† System Prompt æž„å»º
   - âœ… å®žçŽ°äº† Agent åœæ­¢æœºåˆ¶

2. **Agent çŠ¶æ€ç®¡ç†** (`packages/renderer/src/llmbox/AgentStore.ts`)
   - âœ… å®žçŽ°äº† AgentStore MobX store
   - âœ… ç®¡ç†å·¥å…·åˆ—è¡¨
   - âœ… ç®¡ç†æ‰§è¡Œæ—¥å¿—
   - âœ… ç®¡ç†è¿è¡ŒçŠ¶æ€
   - âœ… é›†æˆäº† ToolRegistry å’Œ AgentOrchestrator

### Phase 3: UI ç»„ä»¶ âœ…

1. **Agent é¢æ¿** (`packages/renderer/src/llmbox/AgentPanel.tsx`)
   - âœ… å®žçŽ°äº†å·¥å…·åˆ—è¡¨æ˜¾ç¤º
   - âœ… å®žçŽ°äº†æ‰§è¡Œæ—¥å¿—æ˜¾ç¤º
   - âœ… å®žçŽ°äº†çŠ¶æ€æŒ‡ç¤ºå™¨
   - âœ… å®žçŽ°äº†å·¥å…·è°ƒç”¨è¯¦æƒ…å±•å¼€/æŠ˜å 

2. **Agent é¢æ¿æ ·å¼** (`packages/renderer/src/llmbox/AgentPanel.module.scss`)
   - âœ… å®žçŽ°äº†å®Œæ•´çš„æ ·å¼
   - âœ… æ”¯æŒå“åº”å¼å¸ƒå±€
   - âœ… å®žçŽ°äº†ä¸åŒæ­¥éª¤ç±»åž‹çš„è§†è§‰åŒºåˆ†

3. **å…¥å£é›†æˆ** (`packages/renderer/src/entry/llmbox.tsx`)
   - âœ… å®žçŽ°äº† Chat/Agent æ¨¡å¼åˆ‡æ¢
   - âœ… é›†æˆäº† AgentStore
   - âœ… å®žçŽ°äº† Agent è¾“å…¥åŒºåŸŸ
   - âœ… å®žçŽ°äº† Run Agent å’Œ Stop æŒ‰é’®

### Phase 4: æµ‹è¯• âœ…

1. **æž„å»ºéªŒè¯**
   - âœ… `yarn build` æˆåŠŸç¼–è¯‘
   - âœ… æ‰€æœ‰ç±»åž‹æ£€æŸ¥é€šè¿‡
   - âœ… æ‰€æœ‰æ–‡ä»¶æ­£ç¡®æ‰“åŒ…

## æ–‡ä»¶ç»“æž„

```
packages/
â”œâ”€â”€ renderer/src/
â”‚   â”œâ”€â”€ llmbox/
â”‚   â”‚   â”œâ”€â”€ agent/                          âœ… æ–°å¢ž
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts                   âœ… ç±»åž‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ToolRegistry.ts            âœ… å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentOrchestrator.ts      âœ… Agent ç¼–æŽ’å™¨
â”‚   â”‚   â”‚   â””â”€â”€ index.ts                  âœ… å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ AgentStore.ts                  âœ… çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ AgentPanel.tsx                 âœ… UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AgentPanel.module.scss         âœ… æ ·å¼
â”‚   â”‚   â””â”€â”€ index.ts                     âœ… å¯¼å‡º
â”‚   â”‚
â”‚   â””â”€â”€ main/containers/LLMBox/
â”‚       â”œâ”€â”€ LLMBoxFrame.tsx               âœ… æ‰©å±•å®Œæˆ
â”‚       â””â”€â”€ constants.ts                 âœ… æ‰©å±•å®Œæˆ
â”‚
â””â”€â”€ electron/src/
    â””â”€â”€ (æ— éœ€ä¿®æ”¹ï¼Œé€šè¿‡çŽ°æœ‰çš„ DataSource å¤„ç†) âœ…
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. å·¥å…·ç³»ç»Ÿ

#### å·²å®žçŽ°çš„å·¥å…·

| å·¥å…· | æè¿° | æƒé™ | å±é™© |
|-----|------|-------|-------|
| `readFile` | è¯»å–æ–‡ä»¶å†…å®¹ | read | âŒ |
| `writeFile` | å†™å…¥æ–‡ä»¶ï¼ˆè¦†ç›–ï¼‰| write | âœ… |
| `createFile` | åˆ›å»ºæ–°æ–‡ä»¶ | write | âœ… |
| `deleteFile` | åˆ é™¤æ–‡ä»¶ | write | âœ… |
| `listFiles` | åˆ—å‡ºç›®å½• | read | âŒ |
| `searchFiles` | æœç´¢æ–‡ä»¶å | read | âŒ |
| `searchInFile` | æ–‡ä»¶å†…æœç´¢ | read | âŒ |

#### å·¥å…·ç‰¹æ€§

- âœ… å‚æ•°éªŒè¯ï¼ˆJSON Schemaï¼‰
- âœ… é”™è¯¯å¤„ç†
- âœ… æ‰§è¡Œè¶…æ—¶æŽ§åˆ¶
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… è‡ªåŠ¨ç”Ÿæˆ OpenAI Function Schema

### 2. Agent æ‰§è¡Œå¼•æ“Ž

#### æ ¸å¿ƒèƒ½åŠ›

- âœ… å¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨
- âœ… è‡ªåŠ¨å†³ç­–ä¸‹ä¸€æ­¥è¡ŒåŠ¨
- âœ… æ€è€ƒè¿‡ç¨‹å¯è§†åŒ–
- âœ… å·¥å…·è°ƒç”¨åŽ†å²è®°å½•
- âœ… å¯ä¸­æ–­çš„æ‰§è¡Œï¼ˆåœæ­¢æŒ‰é’®ï¼‰
- âœ… æœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶
- âœ… è¶…æ—¶æŽ§åˆ¶

#### æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ åˆå§‹åŒ–æ¶ˆæ¯ â†’ LLM è°ƒç”¨
    â†“
è§£æžå“åº” â†’ æœ‰ tool_calls?
    â†“                     â”œâ”€ Yes â†’ æ‰§è¡Œå·¥å…· â†’ æ›´æ–°æ¶ˆæ¯ â†’ ç»§ç»­è¿­ä»£
    â””â”€ No  â†’ å®Œæˆä»»åŠ¡ â†’ æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ
```

### 3. UI/UX

#### ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ðŸ’¬ Chat] [ðŸ¤– Agent]         â”‚  â† æ¨¡å¼åˆ‡æ¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¥å…·åˆ—è¡¨ (å¯æŠ˜å ï¼‰              â”‚
â”‚  ðŸ“„ readFile                   â”‚
â”‚  âœï¸  writeFile                  â”‚
â”‚  ðŸ” searchFiles                 â”‚
â”‚  ...                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‰§è¡Œæ—¥å¿—                         â”‚
â”‚  1. [thinking] Starting...      â”‚
â”‚  2. [tool_call] readFile       â”‚
â”‚  3. [tool_result] {...}       â”‚
â”‚  4. [final_answer] ...        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŠ¶æ€: executing                â”‚
â”‚  é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æžœæœ‰ï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Enter task...            Send] â”‚  â† è¾“å…¥åŒºåŸŸ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§†è§‰ç‰¹æ€§

- âœ… ä¸åŒæ­¥éª¤ç±»åž‹çš„é¢œè‰²åŒºåˆ†
  - thinking (è“è‰²ï¼‰
  - tool_call (æ©™è‰²ï¼‰
  - tool_result (ç»¿è‰²ï¼‰
  - final_answer (ç´«è‰²ï¼‰
  - error (çº¢è‰²ï¼‰
- âœ… å®žæ—¶çŠ¶æ€æŒ‡ç¤ºï¼ˆåŠ¨ç”»æ•ˆæžœï¼‰
- âœ… å·¥å…·è¯¦æƒ…å±•å¼€/æŠ˜å 
- âœ… æ‰§è¡Œæ—¶é—´æ˜¾ç¤º
- âœ… å·¥å…·æƒé™æ ‡ç­¾ï¼ˆread/writeï¼‰
- âœ… å±é™©å·¥å…·è­¦å‘Šæ ‡è®°

### 4. bidc é€šä¿¡

#### æ¶ˆæ¯ç±»åž‹

```typescript
// çˆ¶çª—å£ â† å­çª—å£
AGENT_FILE_READ
AGENT_FILE_WRITE
AGENT_FILE_CREATE
AGENT_FILE_DELETE
AGENT_FILE_LIST
AGENT_FILE_SEARCH
AGENT_FILE_SEARCH_IN
AGENT_GET_ROOT_URI
AGENT_GET_ACTIVE_FILE_URI
```

#### é€šä¿¡æµç¨‹

```
å­çª—å£ (Agent)         ä¸»çª—å£ (LLMBoxFrame)
     â”‚                         â”‚
     â”‚  1. readFile(uri)      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                         â”‚
     â”‚  2. è°ƒç”¨ dataSource  â”‚
     â”‚                         â”‚
     â”‚  3. è¿”å›ž content       â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                         â”‚
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: è¯»å–æ–‡ä»¶

**ç”¨æˆ·è¾“å…¥:**
```
è¯»å– /project/README.md æ–‡ä»¶çš„å†…å®¹
```

**Agent æ‰§è¡Œæµç¨‹:**
```
1. [thinking] æˆ‘éœ€è¦å…ˆè¯»å– README.md æ–‡ä»¶
2. [tool_call] readFile(uri='file:///project/README.md')
3. [tool_result] è¿”å›žæ–‡ä»¶å†…å®¹ (0.5s)
4. [final_answer] æ–‡ä»¶å†…å®¹å·²è¯»å–...
```

### ç¤ºä¾‹ 2: æ‰¹é‡ä¿®æ”¹æ–‡ä»¶

**ç”¨æˆ·è¾“å…¥:**
```
åœ¨ /docs ç›®å½•ä¸‹æ‰€æœ‰ Markdown æ–‡ä»¶å¼€å¤´æ·»åŠ ç‰ˆæƒå£°æ˜Ž
```

**Agent æ‰§è¡Œæµç¨‹:**
```
1. [thinking] æˆ‘éœ€è¦å…ˆæ‰¾åˆ°æ‰€æœ‰ Markdown æ–‡ä»¶
2. [tool_call] listFiles(uri='file:///docs')
3. [tool_result] è¿”å›žæ–‡ä»¶åˆ—è¡¨
4. [thinking] è¿‡æ»¤å‡º .md æ–‡ä»¶
5. [tool_call] readFile(uri='file:///docs/file1.md')
6. [tool_result] è¿”å›žæ–‡ä»¶å†…å®¹
7. [thinking] æ·»åŠ ç‰ˆæƒå£°æ˜Ž
8. [tool_call] writeFile(uri='file:///docs/file1.md', content='...')
9. [tool_result] å†™å…¥æˆåŠŸ (0.3s)
10. [thinking] å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶...
...
11. [final_answer] å·²å®Œæˆ 5 ä¸ªæ–‡ä»¶ä¿®æ”¹
```

## æŠ€æœ¯äº®ç‚¹

### 1. æž¶æž„è®¾è®¡

- âœ… **å®Œå…¨åœ¨ iframe å†…éƒ¨è¿è¡Œ** - ä¸é˜»å¡žä¸»çº¿ç¨‹
- âœ… **å¤ç”¨çŽ°æœ‰åŸºç¡€è®¾æ–½** - é€šè¿‡ bidc å’Œ DataSource
- âœ… **æ¸…æ™°çš„åˆ†å±‚æž¶æž„** - UIã€çŠ¶æ€ã€æ‰§è¡Œå±‚åˆ†ç¦»
- âœ… **ç±»åž‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»åž‹å®šä¹‰

### 2. æ€§èƒ½ä¼˜åŒ–

- âœ… **MobX å“åº”å¼æ›´æ–°** - è‡ªåŠ¨ UI åŒæ­¥
- âœ… **æ‰¹é‡çŠ¶æ€æ›´æ–°** - ä½¿ç”¨ `runInAction` ä¼˜åŒ–
- âœ… **äº‹ä»¶é©±åŠ¨çš„æž¶æž„** - æŒ‰éœ€æ›´æ–°

### 3. ç”¨æˆ·ä½“éªŒ

- âœ… **å®žæ—¶åé¦ˆ** - æ‰§è¡Œæ­¥éª¤å®žæ—¶æ˜¾ç¤º
- âœ… **å¯ä¸­æ–­** - æ”¯æŒåœæ­¢ Agent
- âœ… **å¯è§†åŒ–è¿›åº¦** - å·¥å…·è°ƒç”¨è¯¦æƒ…æ¸…æ™°å±•ç¤º
- âœ… **é”™è¯¯æç¤º** - è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## åŽç»­ä¼˜åŒ–å»ºè®®

### 1. åŠŸèƒ½å¢žå¼º

- [ ] ç”¨æˆ·ç¡®è®¤æœºåˆ¶ï¼ˆå±é™©æ“ä½œï¼‰
- [ ] å·¥å…·æƒé™é…ç½®
- [ ] è‡ªå®šä¹‰å·¥å…·æ”¯æŒ
- [ ] Agent æ‰§è¡ŒåŽ†å²æŒä¹…åŒ–
- [ ] æ‰§è¡Œç»“æžœç¼“å­˜

### 2. æ€§èƒ½ä¼˜åŒ–

- [ ] å·¥å…·æ‰§è¡Œç»“æžœç¼“å­˜
- [ ] æ‰§è¡Œæ—¥å¿—è™šæ‹Ÿæ»šåŠ¨
- [ ] å¤§æ–‡ä»¶æµå¼å¤„ç†
- [ ] å·¥å…·å¹¶è¡Œæ‰§è¡Œ

### 3. ç”¨æˆ·ä½“éªŒ

- [ ] Agent æ¨¡æ¿ï¼ˆé¢„å®šä¹‰ä»»åŠ¡ï¼‰
- [ ] æ‰§è¡Œé¢„è§ˆ
- [ ] æ’¤é”€/é‡åšåŠŸèƒ½
- [ ] å¯¼å‡ºæ‰§è¡ŒæŠ¥å‘Š

### 4. æµ‹è¯•

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] E2E æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

## æž„å»ºçŠ¶æ€

```bash
âœ… TypeScript ç¼–è¯‘æˆåŠŸ
âœ… æ‰€æœ‰åŒ…æž„å»ºæˆåŠŸ
âš ï¸  éƒ¨åˆ†èµ„æºè¶…è¿‡æŽ¨èå¤§å° (éœ€è¦ä¼˜åŒ–)
   - llmbox.bundle.js (1.61 MiB)
   - main.bundle.js (22.2 MiB)
```

## æ–‡æ¡£æ›´æ–°

- âœ… åˆ›å»ºè®¾è®¡æ–‡æ¡£: `docs/design/Agentè®¾è®¡.md`
- âœ… æ›´æ–°æ–‡æ¡£å¯¼èˆª: `docs/README.md`

## ä¸‹ä¸€æ­¥

1. **æµ‹è¯•éªŒè¯**
   - å¯åŠ¨åº”ç”¨å¹¶æµ‹è¯• Agent æ¨¡å¼
   - éªŒè¯å„ä¸ªå·¥å…·åŠŸèƒ½
   - æµ‹è¯•å¤šè½®è¿­ä»£åœºæ™¯

2. **é—®é¢˜ä¿®å¤**
   - ä¿®å¤æž„å»ºè­¦å‘Š
   - ä¼˜åŒ–èµ„æºå¤§å°
   - å®Œå–„é”™è¯¯å¤„ç†

3. **åŠŸèƒ½å¢žå¼º**
   - å®žçŽ°ç”¨æˆ·ç¡®è®¤æœºåˆ¶
   - æ·»åŠ æ›´å¤šå†…ç½®å·¥å…·
   - ä¼˜åŒ– System Prompt

4. **æ–‡æ¡£å®Œå–„**
   - ç¼–å†™ç”¨æˆ·ä½¿ç”¨æŒ‡å—
   - æ·»åŠ ç¤ºä¾‹ä»£ç 
   - åˆ›å»ºæ•™ç¨‹è§†é¢‘

## æ€»ç»“

Agent åŠŸèƒ½çš„æ ¸å¿ƒå®žçŽ°å·²å®Œæˆï¼ŒåŒ…æ‹¬ï¼š

âœ… **å®Œæ•´çš„å·¥å…·ç³»ç»Ÿ** - 7 ä¸ªå†…ç½®å·¥å…·
âœ… **å¼ºå¤§çš„æ‰§è¡Œå¼•æ“Ž** - å¤šè½®è¿­ä»£ã€æ™ºèƒ½å†³ç­–
âœ… **å‹å¥½çš„ UI** - å®žæ—¶åé¦ˆã€å¯è§†åŒ–æ‰§è¡Œ
âœ… **æ¸…æ™°çš„æž¶æž„** - åˆ†å±‚è®¾è®¡ã€ç±»åž‹å®‰å…¨
âœ… **å¯æ‰©å±•æ€§** - æ˜“äºŽæ·»åŠ æ–°å·¥å…·å’ŒåŠŸèƒ½

ç³»ç»Ÿå·²å¯æ­£å¸¸æž„å»ºï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•å’Œä½¿ç”¨ï¼

---

**å®žçŽ°æ—¥æœŸ**: 2026-01-06
**å®žçŽ°è€…**: Claude Code
**ç‰ˆæœ¬**: 1.0.0
