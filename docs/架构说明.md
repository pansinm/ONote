# ONote æ¶æ„è¯´æ˜

## ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [é€šä¿¡æœºåˆ¶](#é€šä¿¡æœºåˆ¶)
- [çŠ¶æ€ç®¡ç†](#çŠ¶æ€ç®¡ç†)
- [æ’ä»¶ç³»ç»Ÿ](#æ’ä»¶ç³»ç»Ÿ)
- [æ•°æ®æµ](#æ•°æ®æµ)

---

## ç³»ç»Ÿæ¦‚è¿°

ONote æ˜¯ä¸€ä¸ªåŸºäº Electron çš„è·¨å¹³å°æ¡Œé¢ç¬”è®°åº”ç”¨ï¼Œé‡‡ç”¨ Monorepo æ¶æ„ã€‚åº”ç”¨æ”¯æŒ Markdown ç¼–è¾‘ã€å®æ—¶é¢„è§ˆã€AI é›†æˆã€å¤šæ•°æ®æºç­‰ä¸°å¯ŒåŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ

- **æ¡Œé¢æ¡†æ¶**: Electron 35.7.5
- **UI æ¡†æ¶**: React 18.2.0
- **ç¼–ç¨‹è¯­è¨€**: TypeScript 5.3.3
- **çŠ¶æ€ç®¡ç†**: MobX 6.4.1
- **ç¼–è¾‘å™¨**: Monaco Editor 0.45.0
- **UI ç»„ä»¶åº“**: @fluentui/react-components 9.49.2
- **æ„å»ºå·¥å…·**: Webpack 5, Turborepo
- **åŒ…ç®¡ç†**: Yarn Workspaces

### æ ¸å¿ƒç‰¹æ€§

- ğŸ“ Markdown å®æ—¶ç¼–è¾‘ä¸é¢„è§ˆ
- ğŸŒ³ å¤šæ•°æ®æºæ”¯æŒï¼ˆæœ¬åœ°ã€SSHã€Gitï¼‰
- ğŸ”Œ æ’ä»¶åŒ–æ¶æ„
- ğŸ¤– AI é›†æˆï¼ˆOpenAI APIï¼‰
- ğŸ“Š å›¾è¡¨æ”¯æŒï¼ˆMermaidã€PlantUMLã€Graphvizï¼‰
- ğŸ¨ æ•°å­¦å…¬å¼æ¸²æŸ“ï¼ˆKaTeXï¼‰
- ğŸ–¥ï¸ å¤šçª—å£æ”¯æŒï¼ˆä¸»çª—å£ã€é¢„è§ˆçª—å£ï¼‰
- ğŸŒ WebDAV æœåŠ¡å™¨

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

ONote é‡‡ç”¨ç»å…¸çš„ Electron å¤šè¿›ç¨‹æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ONote Application                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Main Process       â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Renderer Processâ”‚ â”‚
â”‚  â”‚  (Node.js Context)   â”‚ IPC  â”‚  (Web Context)  â”‚ â”‚
â”‚  â”‚                      â”‚      â”‚                 â”‚ â”‚
â”‚  â”‚  - Window Management â”‚      â”‚  - React UI     â”‚ â”‚
â”‚  â”‚  - File System       â”‚      â”‚  - Monaco Editorâ”‚ â”‚
â”‚  â”‚  - IPC Server        â”‚      â”‚  - Previewer    â”‚ â”‚
â”‚  â”‚  - Plugin Manager    â”‚      â”‚  - MobX Stores  â”‚ â”‚
â”‚  â”‚  - Data Sources      â”‚      â”‚  - Components   â”‚ â”‚
â”‚  â”‚  - WebDAV Server     â”‚      â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                           â”‚          â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                    â”‚ Shared Code â”‚  â”‚
â”‚                                    â”‚  (Types,    â”‚  â”‚
â”‚                                    â”‚   Utils)    â”‚  â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Monorepo ç»“æ„

é¡¹ç›®é‡‡ç”¨ Turborepo ç®¡ç†çš„ Monorepo æ¶æ„ï¼š

```
ONote/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ electron/      # ä¸»è¿›ç¨‹ä»£ç 
â”‚   â”œâ”€â”€ renderer/      # æ¸²æŸ“è¿›ç¨‹ä»£ç 
â”‚   â””â”€â”€ shared/        # å…±äº«ä»£ç 
â”œâ”€â”€ buildResources/    # æ„å»ºèµ„æº
â”œâ”€â”€ docs/             # æ–‡æ¡£
â””â”€â”€ [é…ç½®æ–‡ä»¶]
```

---

## ç›®å½•ç»“æ„

### packages/electron - ä¸»è¿›ç¨‹

ä¸»è¿›ç¨‹è´Ÿè´£åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ç³»ç»Ÿçº§æ“ä½œå’Œåç«¯æœåŠ¡ã€‚

```
packages/electron/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ dataSource/          # æ•°æ®æºç®¡ç†
â”‚   â”‚   â”œâ”€â”€ DataSource.ts   # æ•°æ®æºæŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ LocalDataSource.ts
â”‚   â”‚   â”œâ”€â”€ SSHDataSource.ts
â”‚   â”‚   â””â”€â”€ GiteeDataSource.ts
â”‚   â”œâ”€â”€ ipc-server/          # IPC é€šä¿¡æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ IPCServer.ts    # IPC æœåŠ¡å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ handlers/       # IPC å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DataSourceHandler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingHandler.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ plugin/              # æ’ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ PluginManager.ts
â”‚   â”‚   â””â”€â”€ plugins/
â”‚   â”œâ”€â”€ window/              # çª—å£ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ server/              # WebDAV æœåŠ¡å™¨
â”‚   â”œâ”€â”€ setting/             # è®¾ç½®ç®¡ç†
â”‚   â”œâ”€â”€ preload/             # é¢„åŠ è½½è„šæœ¬
â”‚   â”œâ”€â”€ tunnel/              # éš§é“æœåŠ¡
â”‚   â”œâ”€â”€ tray/                # ç³»ç»Ÿæ‰˜ç›˜
â”‚   â”œâ”€â”€ constants.ts         # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ index.ts             # ä¸»è¿›ç¨‹å…¥å£
â”‚   â””â”€â”€ security-restrictions.ts
â””â”€â”€ features/                # E2E æµ‹è¯•ç‰¹æ€§
```

### packages/renderer - æ¸²æŸ“è¿›ç¨‹

æ¸²æŸ“è¿›ç¨‹è¿è¡Œç”¨æˆ·ç•Œé¢ï¼ŒåŸºäº React å’Œ MobXã€‚

```
packages/renderer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                # ä¸»åº”ç”¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ stores/         # MobX çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ActivationStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ FileListStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ FileStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ LayoutStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ TodoStore.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ containers/     # å®¹å™¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar/
â”‚   â”‚   â”‚   â”œâ”€â”€ Editor/
â”‚   â”‚   â”‚   â”œâ”€â”€ Previewer/
â”‚   â”‚   â”‚   â””â”€â”€ Page.tsx
â”‚   â”‚   â”œâ”€â”€ services/       # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â””â”€â”€ file-service.ts
â”‚   â”‚   â”œâ”€â”€ App.tsx         # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ components/          # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ previewer/           # Markdown é¢„è§ˆå™¨
â”‚   â”‚   â”œâ”€â”€ handlers/       # æ¸²æŸ“å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ code.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ heading.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ math.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ mermaid.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ llmbox/              # AI å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ LLMChatStore.ts
â”‚   â”‚   â”œâ”€â”€ LLMBox.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ common/              # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ styles/              # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ monaco/              # Monaco Editor é…ç½®
â””â”€â”€ webpack.config.js        # Webpack é…ç½®
```

### packages/shared - å…±äº«ä»£ç 

åŒ…å«åœ¨ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´å…±äº«çš„ç±»å‹å®šä¹‰å’Œå·¥å…·å‡½æ•°ã€‚

```
packages/shared/
â””â”€â”€ src/
    â”œâ”€â”€ libs/               # å·¥å…·åº“
    â”‚   â””â”€â”€ path/
    â””â”€â”€ index.ts
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. ä¸»è¿›ç¨‹ (Main Process)

ä¸»è¿›ç¨‹æ˜¯åº”ç”¨çš„å…¥å£ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç†åº”ç”¨çª—å£ã€ç³»ç»Ÿçº§æ“ä½œã€‚

**ä¸»è¦èŒè´£ï¼š**
- åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- çª—å£åˆ›å»ºå’Œç®¡ç†
- ç³»ç»Ÿæ‰˜ç›˜
- åŸç”Ÿèœå•
- æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- IPC é€šä¿¡æœåŠ¡å™¨

**å…¥å£æ–‡ä»¶**: [packages/electron/src/index.ts](../packages/electron/src/index.ts)

**å…³é”®ä»£ç ï¼š**
```typescript
// åº”ç”¨å¯åŠ¨æµç¨‹
app.whenReady()
  .then(() => startIpcServer())        // å¯åŠ¨ IPC æœåŠ¡å™¨
  .then(() => restoreOrCreateWindow()) // åˆ›å»ºä¸»çª—å£
  .then(() => pluginManager.loadAll()) // åŠ è½½æ’ä»¶
```

### 2. æ¸²æŸ“è¿›ç¨‹ (Renderer Process)

æ¸²æŸ“è¿›ç¨‹è¿è¡Œç”¨æˆ·ç•Œé¢ï¼ŒåŸºäº React æ„å»ºã€‚

**ä¸»è¦èŒè´£ï¼š**
- UI æ¸²æŸ“å’Œäº¤äº’
- Monaco Editor é›†æˆ
- Markdown é¢„è§ˆ
- ç”¨æˆ·è¾“å…¥å¤„ç†
- çŠ¶æ€ç®¡ç†

**å…¥å£æ–‡ä»¶**: [packages/renderer/src/main/index.tsx](../packages/renderer/src/main/index.tsx)

**ç»„ä»¶å±‚çº§ï¼š**
```
App
â”œâ”€â”€ Sidebar         # ä¾§è¾¹æ ï¼ˆæ–‡ä»¶æ ‘ï¼‰
â”œâ”€â”€ Page            # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ Editor      # ç¼–è¾‘å™¨
â”‚   â””â”€â”€ Previewer   # é¢„è§ˆå™¨
â””â”€â”€ EventBus        # äº‹ä»¶æ€»çº¿
```

### 3. IPC é€šä¿¡ (Inter-Process Communication)

ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹é€šè¿‡ IPC è¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨å‘½åç©ºé—´ç»„ç»‡ã€‚

**IPC æœåŠ¡å™¨**: [packages/electron/src/ipc-server/](../packages/electron/src/ipc-server/)

**å‘½åç©ºé—´ï¼š**
```typescript
enum IPCNamespaces {
  DataSource = 'DataSource',      // æ•°æ®æºæ“ä½œ
  Setting = 'Setting',            // è®¾ç½®ç®¡ç†
  DevelopTools = 'DevelopTools',  // å¼€å‘å·¥å…·
  PluginManager = 'PluginManager', // æ’ä»¶ç®¡ç†
  Cron = 'Cron',                  // å®šæ—¶ä»»åŠ¡
  Typst = 'Typst',                // Typst æ¸²æŸ“
}
```

**é€šä¿¡æµç¨‹ï¼š**
```
Renderer Process          Main Process
     â”‚                        â”‚
     â”‚  ipcRenderer.invoke    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                        â”‚  Handler.process()
     â”‚                        â”‚
     â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚     result/error       â”‚
```

### 4. æ•°æ®æºç³»ç»Ÿ (Data Sources)

æ”¯æŒå¤šç§æ•°æ®æºï¼ŒæŠ½è±¡æ¥å£è®¾è®¡ã€‚

**æ¥å£å®šä¹‰**: [packages/electron/src/dataSource/DataSource.ts](../packages/electron/src/dataSource/DataSource.ts)

**æ”¯æŒçš„æ•°æ®æºï¼š**
- **LocalDataSource**: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- **SSHDataSource**: è¿œç¨‹ SSH æœåŠ¡å™¨
- **GiteeDataSource**: Gitee ä»“åº“

**ä¸»è¦æ–¹æ³•ï¼š**
```typescript
interface DataSource {
  list(path: string): Promise<FileEntry[]>
  read(path: string): Promise<string>
  write(path: string, content: string): Promise<void>
  watch(path: string, callback: Function): Promise<Closeable>
  // ...
}
```

### 5. æ’ä»¶ç³»ç»Ÿ (Plugin System)

æ”¯æŒåŠ¨æ€åŠ è½½æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚

**æ’ä»¶ç®¡ç†å™¨**: [packages/electron/src/plugin/PluginManager.ts](../packages/electron/src/plugin/PluginManager.ts)

**æ’ä»¶ç›®å½•**: [packages/electron/src/plugin/plugins/](../packages/electron/src/plugin/plugins/)

---

## é€šä¿¡æœºåˆ¶

### IPC é€šä¿¡æ¶æ„

ONote ä½¿ç”¨è‡ªå®šä¹‰çš„ IPC æœåŠ¡å™¨å®ç°ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„é€šä¿¡ã€‚

**IPC æœåŠ¡å™¨åŸºç±»**: [packages/electron/src/ipc-server/IPCServer.ts](../packages/electron/src/ipc-server/IPCServer.ts)

**å…³é”®ç‰¹æ€§ï¼š**
- å‘½åç©ºé—´éš”ç¦»
- è‡ªåŠ¨é”™è¯¯å¤„ç†
- ç±»å‹å®‰å…¨
- äº‹ä»¶å§”æ‰˜

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

æ¸²æŸ“è¿›ç¨‹è°ƒç”¨ï¼š
```typescript
const result = await ipcRenderer.invoke('DataSource.list', '/path/to/dir');
```

ä¸»è¿›ç¨‹å¤„ç†ï¼š
```typescript
class DataSourceHandler {
  async list(event: IpcInvokeEvent, path: string) {
    return await dataSource.list(path);
  }
}
```

### äº‹ä»¶å§”æ‰˜

è‡ªåŠ¨å°†æ•°æ®æºäº‹ä»¶è½¬å‘åˆ°æ¸²æŸ“è¿›ç¨‹ï¼š

```typescript
delegateEvent(
  dataSource,
  EventNames.FileContentChanged,
  IPCNamespaces.DataSource,
  () => webContents.fromFrame(getMainFrame()!)!,
);
```

---

## çŠ¶æ€ç®¡ç†

### MobX Store æ¶æ„

ä½¿ç”¨ MobX è¿›è¡Œå“åº”å¼çŠ¶æ€ç®¡ç†ï¼Œæ‰€æœ‰ Store ä½äº [packages/renderer/src/main/stores/](../packages/renderer/src/main/stores/)ã€‚

**æ ¸å¿ƒ Storeï¼š**

#### 1. ActivationStore
ç®¡ç†åº”ç”¨æ¿€æ´»çŠ¶æ€å’Œ UI å¯è§æ€§ã€‚

```typescript
class ActivationStore {
  hideSidebar = false;
  currentFileId: string | null = null;

  activateFile(fileId: string) { ... }
  toggleSidebar() { ... }
}
```

#### 2. FileListStore
ç®¡ç†æ–‡ä»¶åˆ—è¡¨çŠ¶æ€ã€‚

```typescript
class FileListStore {
  files: ObservableArray<FileEntry> = [];
  selectedFiles: Set<string> = new Set();

  loadFiles(path: string) { ... }
  selectFile(fileId: string) { ... }
}
```

#### 3. FileStore
ç®¡ç†å½“å‰æ‰“å¼€æ–‡ä»¶çš„çŠ¶æ€ã€‚

```typescript
class FileStore {
  content: string = '';
  isDirty: boolean = false;

  load(fileId: string) { ... }
  save() { ... }
}
```

#### 4. LayoutStore
ç®¡ç†å¸ƒå±€çŠ¶æ€ï¼ˆç¼–è¾‘å™¨/é¢„è§ˆå™¨å¸ƒå±€ï¼‰ã€‚

```typescript
class LayoutStore {
  layout: 'editor' | 'preview' | 'split' = 'split';

  setLayout(layout: LayoutType) { ... }
}
```

#### 5. SettingStore
ç®¡ç†åº”ç”¨è®¾ç½®ã€‚

```typescript
class SettingStore {
  theme: string = 'light';
  fontSize: number = 14;

  updateSetting(key: string, value: any) { ... }
}
```

#### 6. TodoStore
ç®¡ç†å¾…åŠäº‹é¡¹ã€‚

```typescript
class TodoStore {
  todos: ObservableArray<TodoItem> = [];

  addTodo(text: string) { ... }
  toggleTodo(id: string) { ... }
}
```

**Store å…¥å£**: [packages/renderer/src/main/stores/index.ts](../packages/renderer/src/main/stores/index.ts)

### çŠ¶æ€æ›´æ–°æµç¨‹

```
User Action
     â”‚
     â–¼
Component Event Handler
     â”‚
     â–¼
MobX Store Action (@action)
     â”‚
     â–¼
Observable State Update
     â”‚
     â–¼
Auto React Re-render
```

---

## æ’ä»¶ç³»ç»Ÿ

### æ’ä»¶æ¶æ„

æ’ä»¶ç³»ç»Ÿå…è®¸åŠ¨æ€æ‰©å±•åº”ç”¨åŠŸèƒ½ã€‚

**æ’ä»¶ç®¡ç†å™¨**: [packages/electron/src/plugin/PluginManager.ts](../packages/electron/src/plugin/PluginManager.ts)

**æ’ä»¶åŠ è½½æµç¨‹ï¼š**
```typescript
// åº”ç”¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰æ’ä»¶
app.whenReady()
  .then(() => pluginManager.loadAll());
```

### IPC æ’ä»¶æ¥å£

æ’ä»¶å¯ä»¥æ³¨å†Œè‡ªå·±çš„ IPC å¤„ç†å™¨ï¼š

```typescript
ipcServer.register(IPCNamespaces.PluginManager, PluginManagerHandler);
```

---

## æ•°æ®æµ

### å…¸å‹æ“ä½œæµç¨‹

#### 1. æ‰“å¼€æ–‡ä»¶æµç¨‹

```
User: Click File in Sidebar
     â”‚
     â–¼
Sidebar Component
     â”‚
     â–¼
FileListStore.selectFile(fileId)
     â”‚
     â–¼
FileStore.load(fileId)
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º IPC: DataSource.read(path)
     â”‚                        â”‚
     â”‚                        â–¼
     â”‚                   Main Process
     â”‚                        â”‚
     â”‚                        â–¼
     â”‚                   DataSource.read()
     â”‚                        â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
Update FileStore.content
     â”‚
     â–¼
Monaco Editor Update
```

#### 2. ä¿å­˜æ–‡ä»¶æµç¨‹

```
User: Ctrl+S
     â”‚
     â–¼
Editor Component
     â”‚
     â–¼
FileStore.save()
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º IPC: DataSource.write(path, content)
     â”‚                        â”‚
     â”‚                        â–¼
     â”‚                   Main Process
     â”‚                        â”‚
     â”‚                        â–¼
     â”‚                   DataSource.write()
     â”‚                        â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
Update FileStore.isDirty = false
```

#### 3. Markdown é¢„è§ˆæµç¨‹

```
Monaco Editor Content Change
     â”‚
     â–¼
Editor Component
     â”‚
     â–¼
Previewer Component
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Markdown AST (unified-mdast)
     â”‚                â”‚
     â”‚                â–¼
     â”‚            Handler Pipeline
     â”‚                â”‚
     â”‚                â”œâ”€â–º Code Handler (prismjs)
     â”‚                â”œâ”€â–º Math Handler (katex)
     â”‚                â”œâ”€â–º Mermaid Handler
     â”‚                â””â”€â–º ...
     â”‚                â”‚
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
React Render HTML
```

---

## æ„å»ºç³»ç»Ÿ

### Turborepo

ä½¿ç”¨ Turborepo ç®¡ç† Monorepo çš„æ„å»ºæµç¨‹ã€‚

**é…ç½®æ–‡ä»¶**: [turbo.json](../turbo.json)

**ä¸»è¦ä»»åŠ¡ï¼š**
- `dev`: å¼€å‘æ¨¡å¼
- `build`: æ„å»º
- `test`: æµ‹è¯•
- `lint`: ä»£ç æ£€æŸ¥

### Webpack é…ç½®

æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨ Webpack æ‰“åŒ…ã€‚

**é…ç½®æ–‡ä»¶**: [packages/renderer/webpack.config.js](../packages/renderer/webpack.config.js)

**å…³é”®ç‰¹æ€§ï¼š**
- TypeScript åŠ è½½
- SCSS æ”¯æŒ
- Monaco Editor Worker é…ç½®
- å¼€å‘æœåŠ¡å™¨çƒ­æ›´æ–°

---

## æ‰©å±•é˜…è¯»

- [å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md) - å¦‚ä½•æ­å»ºå¼€å‘ç¯å¢ƒ
- [ä»£ç è§„èŒƒ](./ä»£ç è§„èŒƒ.md) - ç¼–ç æ ‡å‡†å’Œæœ€ä½³å®è·µ
- [æ’ä»¶å¼€å‘æŒ‡å—](./æ’ä»¶å¼€å‘æŒ‡å—.md) - å¦‚ä½•å¼€å‘æ’ä»¶
- [å¸¸è§é—®é¢˜](./å¸¸è§é—®é¢˜.md) - å¸¸è§é—®é¢˜è§£ç­”

---

## ç»´æŠ¤è€…

å¦‚æœ‰æ¶æ„ç›¸å…³é—®é¢˜ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤å›¢é˜Ÿã€‚
