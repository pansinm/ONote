# Agent åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

Agent åŠŸèƒ½ä¸º ONote æä¾›æ™ºèƒ½ä»»åŠ¡æ‰§è¡Œèƒ½åŠ›ï¼Œé€šè¿‡ LLM å’Œå·¥å…·ç³»ç»Ÿå®ç°è‡ªåŠ¨åŒ–çš„æ–‡ä»¶æ“ä½œã€ä»£ç ä¿®æ”¹ã€æ–‡æ¡£ç”Ÿæˆç­‰å¤æ‚ä»»åŠ¡ã€‚Agent å¯ä»¥è‡ªä¸»å†³ç­–ã€å¤šè½®è¿­ä»£ï¼Œå¹¶é€šè¿‡ bidc ä¸ä¸»çª—å£é€šä¿¡å®Œæˆæ–‡ä»¶æ“ä½œã€‚

## è®¾è®¡ç›®æ ‡

- ğŸ¯ **è‡ªä¸»æ‰§è¡Œ** - Agent å¯ä»¥ç†è§£ç”¨æˆ·æ„å›¾å¹¶è‡ªåŠ¨æ‰§è¡Œå¤æ‚ä»»åŠ¡
- ğŸ”§ **å·¥å…·ç³»ç»Ÿ** - æä¾›ä¸°å¯Œçš„å†…ç½®å·¥å…·ï¼ˆæ–‡ä»¶æ“ä½œã€æœç´¢ç­‰ï¼‰
- ğŸ”„ **å¤šè½®è¿­ä»£** - æ”¯æŒå¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨ï¼Œé€æ­¥å®Œæˆä»»åŠ¡
- ğŸ“Š **å¯è§†åŒ–åé¦ˆ** - å®æ—¶æ˜¾ç¤ºæ‰§è¡Œè¿‡ç¨‹ã€å·¥å…·è°ƒç”¨å’Œç»“æœ
- ğŸš€ **é«˜æ€§èƒ½** - å®Œå…¨åœ¨ iframe å†…éƒ¨è¿è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- ğŸ”’ **å®‰å…¨æ€§** - é€šè¿‡æƒé™æ§åˆ¶å’Œç”¨æˆ·ç¡®è®¤æœºåˆ¶ä¿æŠ¤ç”¨æˆ·æ•°æ®

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ä¸»çª—å£ (Main Window)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLMBoxFrame (çˆ¶çª—å£)                                           â”‚  â”‚
â”‚  â”‚  - ç®¡ç† iframe é€šä¿¡ (bidc)                                        â”‚  â”‚
â”‚  â”‚  - å“åº”æ–‡ä»¶æ“ä½œè¯·æ±‚                                              â”‚  â”‚
â”‚  â”‚  - é€šè¿‡ onote.dataSource æ‰§è¡Œæ–‡ä»¶æ“ä½œ                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                        â”‚
â”‚                              â”‚ bidc é€šä¿¡                               â”‚
â”‚                              â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  <iframe> llmbox (å­çª—å£)                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  UI å±‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Chat Mode (ç°æœ‰)                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€ Agent Mode (æ–°å¢)                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      â”œâ”€â”€ AgentPanel (å·¥å…·åˆ—è¡¨ + æ‰§è¡Œæ—¥å¿—)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      â””â”€â”€ AgentInputArea (Agent è¾“å…¥)                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  çŠ¶æ€ç®¡ç†å±‚ (MobX)                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ LLMChatStore (æ‰©å±• - æ·»åŠ  Agent èƒ½åŠ›)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€ AgentStore (æ–°å¢)                                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Agent æ‰§è¡Œå¼•æ“ (æ–°å¢)                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ ToolRegistry (å·¥å…·æ³¨å†Œè¡¨)                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ AgentOrchestrator (Agent ç¼–æ’å™¨)                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€ BuiltInTools (å†…ç½®å·¥å…·)                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. ToolRegistry (å·¥å…·æ³¨å†Œè¡¨)

**èŒè´£**:
- ç®¡ç†æ‰€æœ‰å¯ç”¨å·¥å…·
- æä¾› OpenAI æ ¼å¼çš„å·¥å…· Schema
- æ‰§è¡Œå·¥å…·è°ƒç”¨ï¼ˆé€šè¿‡ bidc ä¸ä¸»çª—å£é€šä¿¡ï¼‰

**å…³é”®æ–¹æ³•**:
```typescript
class ToolRegistry {
  register(tool: Tool): void;
  getAll(): Tool[];
  get(name: string): Tool | undefined;
  getOpenAISchema(): any[];
}
```

#### 2. AgentOrchestrator (Agent ç¼–æ’å™¨)

**èŒè´£**:
- ç®¡ç† Agent æ‰§è¡Œæµç¨‹
- ä¸ LLM äº¤äº’
- å¤šè½®è¿­ä»£å’Œå·¥å…·è°ƒç”¨
- æ‰§è¡Œæ­¥éª¤ç®¡ç†

**å…³é”®æ–¹æ³•**:
```typescript
class AgentOrchestrator {
  run(prompt: string): Promise<void>;
  stop(): void;
  private callLLM(messages: any[]): Promise<any>;
  private executeToolCalls(toolCalls: ToolCall[]): Promise<any[]>;
  private buildSystemPrompt(): string;
}
```

#### 3. AgentStore (Agent çŠ¶æ€ç®¡ç†)

**èŒè´£**:
- ç®¡ç† Agent çŠ¶æ€
- å·¥å…·åˆ—è¡¨ç®¡ç†
- æ‰§è¡Œæ—¥å¿—å­˜å‚¨
- ä¸ UI ç»„ä»¶é›†æˆ

**çŠ¶æ€**:
```typescript
interface AgentState {
  tools: Tool[];
  executionLog: ExecutionStep[];
  agentState: 'idle' | 'thinking' | 'executing';
  isRunning: boolean;
  error: string | null;
}
```

#### 4. AgentPanel (UI ç»„ä»¶)

**èŒè´£**:
- æ˜¾ç¤ºå¯ç”¨å·¥å…·åˆ—è¡¨
- å±•ç¤ºæ‰§è¡Œæ—¥å¿—
- çŠ¶æ€æŒ‡ç¤º
- ç”¨æˆ·è¾“å…¥å¤„ç†

## å·¥å…·ç³»ç»Ÿ

### å†…ç½®å·¥å…·

| å·¥å…·åç§° | æè¿° | æƒé™ | å±é™© |
|---------|------|-------|-------|
| `readFile` | è¯»å–æ–‡ä»¶å†…å®¹ | read | âŒ |
| `writeFile` | å†™å…¥æ–‡ä»¶ï¼ˆè¦†ç›–ï¼‰ | write | âœ… |
| `createFile` | åˆ›å»ºæ–°æ–‡ä»¶ | write | âœ… |
| `deleteFile` | åˆ é™¤æ–‡ä»¶ | write | âœ… |
| `listFiles` | åˆ—å‡ºç›®å½•å†…å®¹ | read | âŒ |
| `searchFiles` | æœç´¢æ–‡ä»¶å | read | âŒ |
| `searchInFile` | æ–‡ä»¶å†…æœç´¢ | read | âŒ |

### å·¥å…·å®šä¹‰æ ¼å¼

```typescript
interface Tool {
  name: string;
  description: string;
  parameters: {
    type: 'object';
    properties: Record<string, ToolParameter>;
    required?: string[];
  };
  executor: (params: any) => Promise<any>;
  metadata?: {
    category: 'file' | 'search' | 'custom';
    permission: 'read' | 'write';
    dangerous?: boolean;
  };
}
```

### å·¥å…·æ‰§è¡Œæµç¨‹

```
1. LLM è¿”å›å·¥å…·è°ƒç”¨
   â†“
2. AgentOrchestrator è§£æ tool_calls
   â†“
3. ä» ToolRegistry è·å–å·¥å…·
   â†“
4. è°ƒç”¨ tool.executor(params)
   â†“
5. ToolExecutor é€šè¿‡ bidc å‘é€è¯·æ±‚åˆ°ä¸»çª—å£
   â†“
6. ä¸»çª—å£é€šè¿‡ onote.dataSource æ‰§è¡Œæ–‡ä»¶æ“ä½œ
   â†“
7. è¿”å›ç»“æœåˆ° ToolExecutor
   â†“
8. å°†ç»“æœæ·»åŠ åˆ°æ¶ˆæ¯å†å²
   â†“
9. LLM åŸºäºç»“æœå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
```

## bidc é€šä¿¡åè®®

### æ¶ˆæ¯ç±»å‹

```typescript
// ä¸»çª—å£ â†’ å­çª—å£
const LLM_BOX_MESSAGE_TYPES = {
  // Agent æ–‡ä»¶æ“ä½œ
  AGENT_FILE_READ: 'AGENT_FILE_READ',
  AGENT_FILE_WRITE: 'AGENT_FILE_WRITE',
  AGENT_FILE_CREATE: 'AGENT_FILE_CREATE',
  AGENT_FILE_DELETE: 'AGENT_FILE_DELETE',
  AGENT_FILE_LIST: 'AGENT_FILE_LIST',
  AGENT_FILE_SEARCH: 'AGENT_FILE_SEARCH',
  AGENT_FILE_SEARCH_IN: 'AGENT_FILE_SEARCH_IN',
  
  // Agent çŠ¶æ€æŸ¥è¯¢
  AGENT_GET_ROOT_URI: 'AGENT_GET_ROOT_URI',
  AGENT_GET_ACTIVE_FILE_URI: 'AGENT_GET_ACTIVE_FILE_URI',
} as const;
```

### é€šä¿¡ç¤ºä¾‹

#### è¯»å–æ–‡ä»¶

```typescript
// å­çª—å£å‘é€è¯·æ±‚
const response = await channel.send({
  type: 'AGENT_FILE_READ',
  data: { uri: 'file:///path/to/file.md' }
});

// ä¸»çª—å£å¤„ç†
receive(async ({ type, data }) => {
  if (type === 'AGENT_FILE_READ') {
    const { uri } = data;
    const content = await onote.dataSource.invoke('readText', uri);
    return { content };
  }
});
```

#### å†™å…¥æ–‡ä»¶

```typescript
// å­çª—å£å‘é€è¯·æ±‚
const response = await channel.send({
  type: 'AGENT_FILE_WRITE',
  data: { uri: 'file:///path/to/file.md', content: '...' }
});

// ä¸»çª—å£å¤„ç†
receive(async ({ type, data }) => {
  if (type === 'AGENT_FILE_WRITE') {
    const { uri, content } = data;
    await onote.dataSource.invoke('writeText', uri, content);
    return { success: true };
  }
});
```

## Agent æ‰§è¡Œæµç¨‹

### æ‰§è¡Œæµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥ä»»åŠ¡
   â†“
AgentOrchestrator.run(prompt)
   â†“
æ„å»ºåˆå§‹æ¶ˆæ¯ (system + user)
   â†“
å¼€å§‹è¿­ä»£å¾ªç¯
   â†“
   â”œâ”€ callLLM(messages)
   â”‚   â†“
   â”‚   è§£æ LLM å“åº”
   â”‚   â†“
   â”‚   â””â”€ æœ‰ tool_calls?
   â”‚       â”œâ”€ Yes â†’ æ‰§è¡Œå·¥å…·
   â”‚       â”‚   â†“
   â”‚       â”‚   executeToolCalls(toolCalls)
   â”‚       â”‚   â†“
   â”‚       â”‚   å°†ç»“æœæ·»åŠ åˆ° messages
   â”‚       â”‚   â†“
   â”‚       â”‚   ç»§ç»­ä¸‹ä¸€æ¬¡è¿­ä»£
   â”‚       â”‚
   â”‚       â””â”€ No â†’ å®Œæˆä»»åŠ¡
   â”‚           â†“
   â”‚           æ˜¾ç¤º final_answer
   â”‚
   â””â”€ æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»§ç»­ (è¿­ä»£æ¬¡æ•°ã€é”™è¯¯ç­‰)
       â†“
   è¾¾åˆ°æœ€å¤§è¿­ä»£æˆ–å®Œæˆä»»åŠ¡ â†’ ç»“æŸ
```

### æ‰§è¡Œæ­¥éª¤ç±»å‹

| æ­¥éª¤ç±»å‹ | æè¿° | æ˜¾ç¤ºå†…å®¹ |
|---------|------|---------|
| `thinking` | Agent æ€è€ƒè¿‡ç¨‹ | LLM è¿”å›çš„æ–‡æœ¬å†…å®¹ |
| `tool_call` | å·¥å…·è°ƒç”¨è¯·æ±‚ | å·¥å…·åç§°å’Œå‚æ•° |
| `tool_result` | å·¥å…·æ‰§è¡Œç»“æœ | è¿”å›ç»“æœæˆ–é”™è¯¯ä¿¡æ¯ |
| `final_answer` | æœ€ç»ˆç­”æ¡ˆ | ä»»åŠ¡å®Œæˆè¯´æ˜ |
| `error` | é”™è¯¯ä¿¡æ¯ | é”™è¯¯è¯¦æƒ… |

## çŠ¶æ€ç®¡ç†

### AgentStore çŠ¶æ€

```typescript
class AgentStore {
  // å·¥å…·åˆ—è¡¨
  tools: Tool[];

  // æ‰§è¡Œæ—¥å¿—
  executionLog: ExecutionStep[];

  // Agent çŠ¶æ€
  agentState: 'idle' | 'thinking' | 'executing';

  // æ˜¯å¦æ­£åœ¨è¿è¡Œ
  isRunning: boolean;

  // é”™è¯¯ä¿¡æ¯
  error: string | null;
}
```

### çŠ¶æ€è½¬æ¢å›¾

```
idle (ç©ºé—²)
   â†“ ç”¨æˆ·è¾“å…¥
thinking (æ€è€ƒä¸­)
   â†“ LLM è¿”å› tool_calls
executing (æ‰§è¡Œå·¥å…·)
   â†“ å·¥å…·æ‰§è¡Œå®Œæˆ
thinking (æ€è€ƒä¸­) â† æˆ–
   â†“ å†³å®šç»§ç»­æ‰§è¡Œ
executing (æ‰§è¡Œå·¥å…·)
   â†“ ä»»åŠ¡å®Œæˆ / è¾¾åˆ°æœ€å¤§è¿­ä»£
idle (ç©ºé—²)
   â†“ å‘ç”Ÿé”™è¯¯
error (é”™è¯¯)
   â†“
idle (ç©ºé—²)
```

## æ–‡ä»¶ç»„ç»‡

```
packages/
â”œâ”€â”€ renderer/src/
â”‚   â”œâ”€â”€ llmbox/
â”‚   â”‚   â”œâ”€â”€ agent/                          # Agent æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts                   # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ToolRegistry.ts            # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentOrchestrator.ts      # Agent ç¼–æ’å™¨
â”‚   â”‚   â”‚   â””â”€â”€ index.ts                  # å¯¼å‡º
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AgentStore.ts                  # Agent çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ AgentPanel.tsx                 # Agent UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AgentPanel.module.scss         # Agent æ ·å¼
â”‚   â”‚   â”œâ”€â”€ LLMChatStore.ts               # Chat çŠ¶æ€ç®¡ç†ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â”‚   â””â”€â”€ LLMBox.tsx                   # Chat UIï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ main/containers/LLMBox/
â”‚   â”‚   â”œâ”€â”€ LLMBoxFrame.tsx               # çˆ¶çª—å£å®¹å™¨
â”‚   â”‚   â””â”€â”€ constants.ts                 # æ¶ˆæ¯ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â””â”€â”€ entry/
â”‚       â””â”€â”€ llmbox.tsx                    # å­çª—å£å…¥å£
â”‚
â””â”€â”€ electron/src/
    â””â”€â”€ (æ— éœ€ä¿®æ”¹ï¼Œé€šè¿‡ç°æœ‰çš„ DataSource å¤„ç†)
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: è¯»å–æ–‡ä»¶å¹¶æ€»ç»“

```
ç”¨æˆ·è¾“å…¥:
"è¯»å– /project/README.md æ–‡ä»¶çš„å†…å®¹å¹¶æ€»ç»“"

Agent æ‰§è¡Œ:
1. [thinking] æˆ‘éœ€è¦å…ˆè¯»å– README.md æ–‡ä»¶
2. [tool_call] readFile(uri='file:///project/README.md')
3. [tool_result] è¿”å›æ–‡ä»¶å†…å®¹
4. [final_answer] æ€»ç»“æ–‡ä»¶å†…å®¹
```

### ç¤ºä¾‹ 2: æ‰¹é‡ä¿®æ”¹æ–‡ä»¶

```
ç”¨æˆ·è¾“å…¥:
"åœ¨ /docs ç›®å½•ä¸‹æ‰€æœ‰ Markdown æ–‡ä»¶å¼€å¤´æ·»åŠ ç‰ˆæƒå£°æ˜"

Agent æ‰§è¡Œ:
1. [thinking] æˆ‘éœ€è¦å…ˆæ‰¾åˆ°æ‰€æœ‰ Markdown æ–‡ä»¶
2. [tool_call] listFiles(uri='file:///docs')
3. [tool_result] è¿”å›æ–‡ä»¶åˆ—è¡¨
4. [thinking] è¿‡æ»¤å‡º .md æ–‡ä»¶
5. [tool_call] readFile(uri='file:///docs/file1.md')
6. [tool_result] è¿”å›æ–‡ä»¶å†…å®¹
7. [thinking] æ·»åŠ ç‰ˆæƒå£°æ˜
8. [tool_call] writeFile(uri='file:///docs/file1.md', content='...')
9. [tool_result] å†™å…¥æˆåŠŸ
10. [thinking] å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶...
11. [final_answer] å·²å®Œæˆæ‰€æœ‰æ–‡ä»¶ä¿®æ”¹
```

### ç¤ºä¾‹ 3: ä»£ç é‡æ„

```
ç”¨æˆ·è¾“å…¥:
"å°† utils.ts ä¸­çš„æ‰€æœ‰å‡½æ•°æ·»åŠ  JSDoc æ³¨é‡Š"

Agent æ‰§è¡Œ:
1. [thinking] è¯»å–æ–‡ä»¶å†…å®¹
2. [tool_call] readFile(uri='file:///src/utils.ts')
3. [tool_result] è¿”å›ä»£ç 
4. [thinking] åˆ†æå‡½æ•°å¹¶ç”Ÿæˆæ³¨é‡Š
5. [tool_call] writeFile(uri='file:///src/utils.ts', content='å¸¦æ³¨é‡Šçš„ä»£ç ')
6. [final_answer] é‡æ„å®Œæˆ
```

## é…ç½®é€‰é¡¹

### Agent é…ç½®

```typescript
interface AgentConfig {
  apiKey: string;              // OpenAI API Key
  model: string;               // æ¨¡å‹åç§° (gpt-3.5-turbo, gpt-4, etc.)
  apiBase: string;             // API ç«¯ç‚¹
  fileUri?: string;            // å½“å‰æ–‡ä»¶ URI
  rootUri?: string;            // æ ¹ç›®å½• URI
  maxIterations?: number;       // æœ€å¤§è¿­ä»£æ¬¡æ•° (é»˜è®¤ 10)
  showThinking?: boolean;       // æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹ (é»˜è®¤ true)
  timeout?: number;            // è¶…æ—¶æ—¶é—´ (æ¯«ç§’ï¼Œé»˜è®¤ 60000)
}
```

### æ‰§è¡Œé™åˆ¶

```typescript
const DEFAULT_LIMITS = {
  maxIterations: 10,          // æœ€å¤§è¿­ä»£æ¬¡æ•°
  maxToolCalls: 50,           // æœ€å¤§å·¥å…·è°ƒç”¨æ¬¡æ•°
  maxExecutionTime: 300000,    // æœ€å¤§æ‰§è¡Œæ—¶é—´ (5 åˆ†é’Ÿ)
  maxFileSize: 10485760,      // æœ€å¤§æ–‡ä»¶å¤§å° (10 MB)
};
```

## å®‰å…¨è€ƒè™‘

### æƒé™æ§åˆ¶

- **è¯»å–å·¥å…·** (readFile, listFiles, searchFiles) - æ— éœ€ç¡®è®¤
- **å†™å…¥å·¥å…·** (writeFile, createFile) - éœ€è¦ç”¨æˆ·ç¡®è®¤
- **å±é™©å·¥å…·** (deleteFile) - éœ€è¦æ˜ç¡®ç”¨æˆ·ç¡®è®¤

### æ‰§è¡Œé™åˆ¶

- é™åˆ¶æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼ˆé»˜è®¤ 10 æ¬¡ï¼‰
- é™åˆ¶æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼ˆé»˜è®¤ 5 åˆ†é’Ÿï¼‰
- é™åˆ¶å•æ¬¡æ–‡ä»¶æ“ä½œå¤§å°ï¼ˆé»˜è®¤ 10 MBï¼‰
- è®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨æ—¥å¿—

### ç”¨æˆ·ç¡®è®¤æµç¨‹

```typescript
interface ConfirmationRequest {
  toolName: string;
  params: any;
  riskLevel: 'low' | 'medium' | 'high';
  reason: string;
}

interface ConfirmationResponse {
  approved: boolean;
  comment?: string;
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å·¥å…·æ‰§è¡Œä¼˜åŒ–

- å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹çš„å·¥å…·è°ƒç”¨
- è¶…æ—¶æ§åˆ¶æœºåˆ¶
- é”™è¯¯é‡è¯•ç­–ç•¥

### 2. æ—¥å¿—ç®¡ç†

- é™åˆ¶æœ€å¤§æ—¥å¿—æ¡æ•°ï¼ˆé»˜è®¤ 100 æ¡ï¼‰
- å‹ç¼©æ—§çš„æ‰§è¡Œæ­¥éª¤
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡æ—¥å¿—æ—¶ï¼‰

### 3. çŠ¶æ€æ›´æ–°ä¼˜åŒ–

- ä½¿ç”¨ MobX çš„ `runInAction` æ‰¹é‡æ›´æ–°
- é˜²æŠ–é¢‘ç¹çš„çŠ¶æ€å˜åŒ–
- é¿å…ä¸å¿…è¦çš„ UI é‡æ¸²æŸ“

## æ‰©å±•æ€§

### è‡ªå®šä¹‰å·¥å…·

æœªæ¥æ”¯æŒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ³¨å†Œè‡ªå®šä¹‰å·¥å…·ï¼š

```typescript
// æ’ä»¶ç¤ºä¾‹
const customTool: Tool = {
  name: 'webSearch',
  description: 'Search the web',
  parameters: {
    type: 'object',
    properties: {
      query: { type: 'string', description: 'Search query' }
    },
    required: ['query'],
  },
  executor: async (params) => {
    const response = await fetch(`https://api.example.com/search?q=${params.query}`);
    return await response.json();
  },
};

toolRegistry.register(customTool);
```

### LLM æä¾›å•†æ‰©å±•

æ”¯æŒå¤šä¸ª LLM æä¾›å•†ï¼ˆOpenAIã€Anthropicã€Geminiï¼‰ï¼š

```typescript
interface LLMProvider {
  call(messages: any[], tools: any[]): Promise<any>;
  parseResponse(response: any): any;
}
```

## è®¾è®¡ç³»ç»Ÿ

### é…è‰²æ–¹æ¡ˆ

#### äº®è‰²æ¨¡å¼
| ç±»å‹ | é¢œè‰²å€¼ | ç”¨é€” |
|------|--------|------|
| Primary | `#3b82f6` | ä¸»è¦æŒ‰é’®ã€é“¾æ¥ |
| Primary Light | `#60a5fa` | æµ…è‰²èƒŒæ™¯å¼ºè°ƒ |
| Success | `#10b981` | æˆåŠŸçŠ¶æ€ |
| Warning | `#f59e0b` | è­¦å‘ŠçŠ¶æ€ |
| Error | `#ef4444` | é”™è¯¯çŠ¶æ€ |
| Primary BG | `#ffffff` | é¢æ¿èƒŒæ™¯ |
| Secondary BG | `#f8f9fa` | æ¬¡çº§èƒŒæ™¯ |
| Border | `#e5e7eb` | è¾¹æ¡†é¢œè‰² |
| Primary Text | `#1f2937` | ä¸»è¦æ–‡æœ¬ |
| Secondary Text | `#6c757d` | æ¬¡è¦æ–‡æœ¬ |

#### æ·±è‰²æ¨¡å¼
| ç±»å‹ | é¢œè‰²å€¼ | ç”¨é€” |
|------|--------|------|
| Primary | `#60a5fa` | ä¸»è¦æŒ‰é’®ã€é“¾æ¥ |
| Success | `#10b981` | æˆåŠŸçŠ¶æ€ |
| Error | `#ef4444` | é”™è¯¯çŠ¶æ€ |
| Primary BG | `#1e293b` | é¢æ¿èƒŒæ™¯ |
| Secondary BG | `#0f172a` | æ¬¡çº§èƒŒæ™¯ |
| Tertiary BG | `#334155` | è¾“å…¥æ¡†èƒŒæ™¯ |
| Primary Text | `#f1f5f9` | ä¸»è¦æ–‡æœ¬ |
| Secondary Text | `#94a3b8` | æ¬¡è¦æ–‡æœ¬ |

### é˜´å½±ç³»ç»Ÿ
| å±‚çº§ | é˜´å½±å€¼ | ç”¨é€” |
|------|--------|------|
| Small | `0 1px 2px rgba(0, 0, 0, 0.05)` | å°å…ƒç´  |
| Medium | `0 2px 8px rgba(0, 0, 0, 0.1)` | å¡ç‰‡ã€æŒ‰é’® |
| Large | `0 4px 16px rgba(0, 0, 0, 0.15)` | é¢æ¿ã€å¼¹çª— |

### åœ†è§’ç³»ç»Ÿ
| å±‚çº§ | åœ†è§’å€¼ | ç”¨é€” |
|------|--------|------|
| Small | `6px` | å°å…ƒç´ ã€æ ‡ç­¾ |
| Medium | `10px` | å¡ç‰‡ã€æŒ‰é’® |
| Large | `16px` | é¢æ¿ã€å¤§å…ƒç´  |

### æ­¥éª¤ç±»å‹è§†è§‰åŒºåˆ†
| æ­¥éª¤ç±»å‹ | å›¾æ ‡ | è¾¹æ¡†è‰² | èƒŒæ™¯è‰² |
|---------|------|--------|--------|
| thinking | ğŸ’­ | è“è‰² | æµ…è“èƒŒæ™¯ |
| tool_call | ğŸ”§ | æ©™è‰² | æµ…æ©™èƒŒæ™¯ |
| tool_result | âœ… | ç»¿è‰² | æµ…ç»¿èƒŒæ™¯ |
| final_answer | ğŸ¯ | ç´«è‰² | æµ…ç´«èƒŒæ™¯ |
| error | âŒ | çº¢è‰² | æµ…çº¢èƒŒæ™¯ |

### å·¥å…·å›¾æ ‡
| å·¥å…· | å›¾æ ‡ |
|------|------|
| readFile | ğŸ“„ |
| writeFile | âœï¸ |
| createFile | ğŸ“ |
| deleteFile | ğŸ—‘ï¸ |
| listFiles | ğŸ“‚ |
| searchFiles | ğŸ” |
| searchInFile | ğŸ” |

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

- ToolRegistry æµ‹è¯•
- AgentOrchestrator æµ‹è¯•
- AgentStore æµ‹è¯•

### é›†æˆæµ‹è¯•

- bidc é€šä¿¡æµ‹è¯•
- æ–‡ä»¶æ“ä½œæµ‹è¯•
- ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•

### E2E æµ‹è¯•

- å®Œæ•´ä»»åŠ¡æ‰§è¡Œæµ‹è¯•
- å¤šè½®è¿­ä»£æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•

## å®ç°è®¡åˆ’

### Phase 1: åŸºç¡€è®¾æ–½ (Day 1-2)
- [x] åˆ›å»ºç±»å‹å®šä¹‰ (`agent/types.ts`)
- [x] åˆ›å»º ToolRegistry (`agent/ToolRegistry.ts`)
- [x] æ‰©å±•æ¶ˆæ¯ç±»å‹ (`constants.ts`)
- [x] ä¿®æ”¹ LLMBoxFrame æ·»åŠ æ–‡ä»¶æ“ä½œå¤„ç†

### Phase 2: Agent æ ¸å¿ƒé€»è¾‘ (Day 3-4)
- [ ] åˆ›å»º AgentOrchestrator (`agent/AgentOrchestrator.ts`)
- [ ] åˆ›å»º AgentStore (`AgentStore.ts`)
- [ ] å®ç° LLM è°ƒç”¨å’Œå·¥å…·æ‰§è¡Œ
- [ ] å®ç°å¤šè½®è¿­ä»£é€»è¾‘

### Phase 3: UI ç»„ä»¶ (Day 5-6)
- [ ] åˆ›å»º AgentPanel (`AgentPanel.tsx`)
- [ ] åˆ›å»º AgentPanel æ ·å¼ (`AgentPanel.module.scss`)
- [ ] ä¿®æ”¹ llmbox.tsx é›†æˆ Agent æ¨¡å¼
- [ ] å®ç°æ¨¡å¼åˆ‡æ¢

### Phase 4: æµ‹è¯•ä¸ä¼˜åŒ– (Day 7)
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒæ”¹è¿›

## ç›¸å…³æ–‡æ¡£

- [LLMBox æ¶æ„è¯´æ˜](../technical/LLMBoxæ¶æ„è¯´æ˜.md) - AI å¯¹è¯åŠŸèƒ½æ¶æ„
- [LLM å¯¹è¯æŒä¹…åŒ–å®ç°](../technical/LLMå¯¹è¯æŒä¹…åŒ–å®ç°.md) - å¯¹è¯å†å²æŒä¹…åŒ–
- [å¼€å‘æŒ‡å—](../guides/å¼€å‘æŒ‡å—.md) - å¼€å‘æµç¨‹å’Œæœ€ä½³å®è·µ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.1
**åˆ›å»ºæ—¥æœŸ**: 2026-01-06
**æœ€åæ›´æ–°**: 2026-01-16
**ä½œè€…**: ONote å¼€å‘å›¢é˜Ÿ
